import * as tslib_1 from "tslib";
import { Component, Inject } from '@angular/core';
import { FormGroup, FormControl, Validators } from '@angular/forms';
import { MatDialog, MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';
import { EventEmitterService } from '../common/calendar-event-emitter.service';
import format from 'date-fns/format';
import { round } from '@qc/date-round';
var CalendarModalComponent = /** @class */ (function () {
    function CalendarModalComponent(dialogRef, eventEmitterService, data) {
        this.dialogRef = dialogRef;
        this.eventEmitterService = eventEmitterService;
        this.data = data;
        this.screenType = "add";
        this.title = this.data ? "Edit Event" : "Add Event";
        this.titlePlaceholder = this.data ? "Edit Title" : "Add Title";
        this.locationPlaceholder = this.data ? "Edit Location" : "Add Location";
        this.descriptionPlaceholder = this.data ? "Edit Description" : "Add Description";
    }
    CalendarModalComponent.prototype.ngOnInit = function () {
        var dateIn = new Date(); // The date to be rounded
        var interval = 30 * 60 * 1000; // 30 minutes (aka quarter hour)
        var dateOut = round(dateIn, interval);
        var fromTime = format(dateOut, 'HH:mm');
        this.addEvents = new FormGroup({
            title: new FormControl('', Validators.required),
            location: new FormControl(),
            description: new FormControl(),
            fromDate: new FormControl(new Date(), Validators.required),
            toDate: new FormControl('', Validators.required),
            fromTime: new FormControl(fromTime, Validators.required),
            toTime: new FormControl('', Validators.required),
        });
        if (this.data) {
            this.addEvents.disable();
            this.assignEventDetails();
        }
    };
    CalendarModalComponent.prototype.addMinutesToDate = function (date, minutes) {
        return new Date(date.getTime() + minutes * 60000);
    };
    CalendarModalComponent.prototype.assignEventDetails = function () {
        this.screenType = "edit";
        this.addEvents.controls['title'].setValue(this.data.title);
        this.addEvents.controls['location'].setValue(this.data.location);
        this.addEvents.controls['description'].setValue(this.data.description);
        this.addEvents.controls['fromDate'].setValue(this.data.start);
        this.addEvents.controls['toDate'].setValue(this.data.end);
        this.addEvents.controls['fromTime'].setValue(this.data.fromTime);
        this.addEvents.controls['toTime'].setValue(this.data.toTime);
    };
    CalendarModalComponent.prototype.addOrUpdateEvent = function () {
        var tempObject = {
            title: this.addEvents.controls['title'].value,
            description: this.addEvents.controls['description'].value,
            location: this.addEvents.controls['location'].value,
            start: this.addEvents.controls['fromDate'].value,
            end: this.addEvents.controls['toDate'].value,
            fromTime: this.addEvents.controls['fromTime'].value,
            toTime: this.addEvents.controls['toTime'].value
        };
        var startDatetime = tempObject.start + ' ' + tempObject.fromTime;
        var endDatetime = tempObject.end + ' ' + tempObject.toTime;
        console.log("startDatetime, endDatetime", startDatetime, endDatetime);
        if (this.data === null) {
            this.eventEmitterService.emitNavChangeEvent('ADD_SAVE_CLICKED', tempObject);
        }
        else {
            this.eventEmitterService.emitNavChangeEvent('EDIT_SAVE_CLICKED', tempObject);
        }
        this.dialogRef.close();
    };
    CalendarModalComponent.prototype.onNoClick = function () {
        this.dialogRef.close();
    };
    CalendarModalComponent.prototype.onDelete = function () {
        this.eventEmitterService.emitNavChangeEvent('DELETE_EVENT_CLICKED', this.data);
        this.dialogRef.close();
    };
    CalendarModalComponent.prototype.onEdit = function () {
        this.addEvents.enable();
    };
    CalendarModalComponent.ctorParameters = function () { return [
        { type: MatDialogRef },
        { type: EventEmitterService },
        { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] }
    ]; };
    CalendarModalComponent = tslib_1.__decorate([
        Component({
            selector: 'app-calendar-modal',
            template: "<div class=\"header\" id=\"header-view\">\n  <div class=\"titleStyle\">\n    <h1 mat-dialog-title style=\"font-family: Poppins;\">{{title}}</h1>\n  </div>\n  <div>\n    <mat-icon *ngIf=\"title === 'Edit Event'\" aria-hidden=\"false\" style=\"cursor: pointer;\" (click)=\"onEdit()\">edit\n    </mat-icon>\n    <mat-icon *ngIf=\"title === 'Edit Event'\" aria-hidden=\"false\" style=\"cursor: pointer;\" (click)=\"onDelete()\">delete\n    </mat-icon>\n    <mat-icon aria-hidden=\"false\" style=\"cursor: pointer;\" (click)=\"onNoClick()\">close</mat-icon>\n  </div>\n</div>\n<div mat-dialog-content id=\"dialog-container\">\n\n  <form class=\"example-form\" [formGroup]=\"addEvents\" (ngSubmit)=\"addOrUpdateEvent()\">\n\n    <mat-form-field class=\"example-full-width\" id=\"Add-title-view\"\n      style=\"font-family: Poppins;width: 95% !important;margin-left: 5%;\">\n      <input class=\"add-title-input\" matInput placeholder=\"{{titlePlaceholder}}\" formControlName=\"title\">\n    </mat-form-field>\n\n    <div class=\"timeinterval\" id=\"start-end-time\" style=\"display: flex !important;align-items: center;\">\n\n      <mat-icon aria-hidden=\"false\">access_time</mat-icon>\n      <div style=\"display: flex !important;\njustify-content: space-between !important;align-items: center;margin-left: 2%;padding-right: 2%;width: calc(100% - 5%);\">\n        <mat-form-field class=\"example-full-width\" style=\"width: 22%;\">\n          <mat-label>Start date</mat-label>\n          <input matInput formControlName=\"fromDate\" [matDatepicker]=\"picker\" >\n          <mat-datepicker-toggle matSuffix [for]=\"picker\">\n            <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>\n          </mat-datepicker-toggle>\n          <mat-datepicker #picker></mat-datepicker>\n        </mat-form-field>\n\n        <mat-form-field class=\"start-time-view\">\n          <input matInput [ngxTimepicker]=\"fromTime\" [format]=\"24\" formControlName=\"fromTime\"  readonly >\n          <ngx-material-timepicker #fromTime></ngx-material-timepicker>\n        </mat-form-field>\n\n        <mat-form-field class=\"end-time-view\">\n          <input matInput [ngxTimepicker]=\"toTime\" [format]=\"24\" formControlName=\"toTime\" readonly\n            [disabled]=\"addEvents.controls['fromTime'].value > addEvents.controls['toTime'].value\">\n          <ngx-material-timepicker #toTime></ngx-material-timepicker>\n        </mat-form-field>\n\n        <mat-form-field id=\"end-date-view\"class=\"example-full-width\" style=\"width: 22%;font-family: Poppins;\">\n          <mat-label>End date</mat-label>\n          <input [min]=\"addEvents.controls['fromDate'].value\" matInput formControlName=\"toDate\"\n            [matDatepicker]=\"datepicker\" >\n          <mat-datepicker-toggle matSuffix [for]=\"datepicker\">\n            <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>\n          </mat-datepicker-toggle>\n          <mat-datepicker #datepicker></mat-datepicker>\n        </mat-form-field>\n      </div>\n\n    </div>\n\n    <div class=\"header\" id=\"location-view\">\n      <mat-icon aria-hidden=\"false\">location_on</mat-icon>\n      <mat-form-field class=\"form-field\" style=\"margin-left: 2%;\">\n        <input  class=\"location-input-view\" matInput placeholder=\"{{locationPlaceholder}}\" formControlName=\"location\"\n          style=\" width: 95% !important;\" />\n      </mat-form-field>\n    </div>\n\n    <div class=\"text-area-container\">\n      <mat-icon aria-hidden=\"false\" class=\"menu-icon-view\">menu</mat-icon>\n      <textarea id=\"text-input-view\"class=\"text-area-view\" placeholder=\"{{descriptionPlaceholder}}\" formControlName=\"description\"></textarea>\n    </div>\n    <div class=\"save-button-view\">\n      <button type=\"submit\" mat-button class=\"event-button\" [disabled]=\"!addEvents.valid\" [ngStyle]=\"{ 'opacity' : !addEvents.valid ? '0.5' : '1.5' }\">Save</button>\n    </div>\n  </form>\n</div>\n\n",
            styles: [".cdk-overlay-container{z-index:1127}.form-field{font-family:Poppins;width:95%!important}.event-button{background:#404041;color:#fff;width:141px;height:42px;border-radius:4px;border:1px solid #404041}.titleStyle{display:-webkit-box;display:flex;-webkit-box-pack:justify;justify-content:space-between}.header{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-pack:justify;justify-content:space-between;-webkit-box-align:center;align-items:center}.save-button-view{display:-webkit-box;display:flex;-webkit-box-pack:end;justify-content:flex-end;-webkit-box-align:center;align-items:center;margin-bottom:0!important}.save-button-view button{width:110px;height:47px;border-radius:6px;background-color:#404041}.text-area-view{width:100%!important;height:75px;resize:unset;overflow:auto;padding-top:5px;padding-left:5px;margin-left:2%;border-radius:5px;font-family:poppins}.text-area-container{display:-webkit-box;display:flex;-webkit-box-align:start;align-items:flex-start;padding-top:28px;padding-bottom:2%}.menu-icon-view{position:relative;bottom:3px}.titleStyle h1{margin-bottom:0!important;font-family:Poppins;font-size:28px;font-weight:500;font-stretch:normal;font-style:normal;line-height:1.5;letter-spacing:.01px;text-align:left;color:#404041}.add-title-input{font-size:20px!important;font-weight:500!important;font-stretch:normal!important;font-style:normal!important;letter-spacing:.01px!important;text-align:left!important;color:#7b7f8b!important}input{font-size:20px;font-weight:500;font-stretch:normal;font-style:normal;letter-spacing:.01px;text-align:left;color:#7b7f8b}#dialog-container{max-height:70vh!important}@media (max-width:991px){.end-time-view,.start-time-view{width:15%!important}}.example-full-width input{width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:14px!important}.start-time-view input{width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:14px}.end-time-view input{width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:14px!important}.location-input-view{font-size:14px}#text-input-view{font-size:14px;color:#7b7f8b}#start-end-time{padding-top:18px}.mat-input-placeholder{color:#fff;font-size:2em}.mat-form-field-label,mat-label{font-size:14px!important}#location-view{margin-top:6px}#header-view{margin-bottom:12px}"]
        }),
        tslib_1.__param(2, Inject(MAT_DIALOG_DATA))
    ], CalendarModalComponent);
    return CalendarModalComponent;
}());
export { CalendarModalComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXItbW9kYWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmVvLWNhbGVuZGFyLyIsInNvdXJjZXMiOlsibW9kdWxlcy9jYWxlbmRhci1tb2RhbC9jYWxlbmRhci1tb2RhbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFDLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLGVBQWUsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3BGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQy9FLE9BQU8sTUFBTSxNQUFNLGlCQUFpQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQU92QztJQVNFLGdDQUFtQixTQUErQyxFQUN6RCxtQkFBd0MsRUFDZixJQUFTO1FBRnhCLGNBQVMsR0FBVCxTQUFTLENBQXNDO1FBQ3pELHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBcUI7UUFDZixTQUFJLEdBQUosSUFBSSxDQUFLO1FBVDNDLGVBQVUsR0FBRyxLQUFLLENBQUM7UUFDbkIsVUFBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDO1FBQy9DLHFCQUFnQixHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDO1FBQzFELHdCQUFtQixHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDO1FBQ25FLDJCQUFzQixHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FB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UyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3pCLENBQUM7SUFFRCx5Q0FBUSxHQUFSO1FBQ0UsSUFBSSxDQUFDLG1CQUFtQixDQUFDLGtCQUFrQixDQUFDLHNCQUFzQixFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvRSxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3pCLENBQUM7SUFFRCx1Q0FBTSxHQUFOO1FBQ0UsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQTtJQUN6QixDQUFDOztnQkEzRTZCLFlBQVk7Z0JBQ1osbUJBQW1CO2dEQUM5QyxNQUFNLFNBQUMsZUFBZTs7SUFYZCxzQkFBc0I7UUFMbEMsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLG9CQUFvQjtZQUM5Qiw4NEhBQThDOztTQUUvQyxDQUFDO1FBWUcsbUJBQUEsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFBO09BWGYsc0JBQXNCLENBdUZsQztJQUFELDZCQUFDO0NBQUEsQUF2RkQsSUF1RkM7U0F2Rlksc0JBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEluamVjdCwgT25DaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1Db250cm9sLFZhbGlkYXRvcnMgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBNYXREaWFsb2csIE1hdERpYWxvZ1JlZiwgTUFUX0RJQUxPR19EQVRBIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZGlhbG9nJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlclNlcnZpY2UgfSBmcm9tICcuLi9jb21tb24vY2FsZW5kYXItZXZlbnQtZW1pdHRlci5zZXJ2aWNlJztcbmltcG9ydCBmb3JtYXQgZnJvbSAnZGF0ZS1mbnMvZm9ybWF0JztcbmltcG9ydCB7IHJvdW5kIH0gZnJvbSAnQHFjL2RhdGUtcm91bmQnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdhcHAtY2FsZW5kYXItbW9kYWwnLFxuICB0ZW1wbGF0ZVVybDogJy4vY2FsZW5kYXItbW9kYWwuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9jYWxlbmRhci1tb2RhbC5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIENhbGVuZGFyTW9kYWxDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIHNjcmVlblR5cGUgPSBcImFkZFwiO1xuICB0aXRsZSA9IHRoaXMuZGF0YSA/IFwiRWRpdCBFdmVudFwiIDogXCJBZGQgRXZlbnRcIjtcbiAgdGl0bGVQbGFjZWhvbGRlciA9IHRoaXMuZGF0YSA/IFwiRWRpdCBUaXRsZVwiIDogXCJBZGQgVGl0bGVcIjtcbiAgbG9jYXRpb25QbGFjZWhvbGRlciA9IHRoaXMuZGF0YSA/IFwiRWRpdCBMb2NhdGlvblwiIDogXCJBZGQgTG9jYXRpb25cIjtcbiAgZGVzY3JpcHRpb25QbGFjZWhvbGRlciA9IHRoaXMuZGF0YSA/IFwiRWRpdCBEZXNjcmlwdGlvblwiIDogXCJBZGQgRGVzY3JpcHRpb25cIjtcbiAgYWRkRXZlbnRzOiBGb3JtR3JvdXA7XG5cbiAgY29uc3RydWN0b3IocHVibGljIGRpYWxvZ1JlZjogTWF0RGlhbG9nUmVmPENhbGVuZGFyTW9kYWxDb21wb25lbnQ+LFxuICAgIHB1YmxpYyBldmVudEVtaXR0ZXJTZXJ2aWNlOiBFdmVudEVtaXR0ZXJTZXJ2aWNlLFxuICAgIEBJbmplY3QoTUFUX0RJQUxPR19EQVRBKSBwdWJsaWMgZGF0YTogYW55XG4gICkgeyBcbiAgICBcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGNvbnN0IGRhdGVJbiA9IG5ldyBEYXRlKCkgLy8gVGhlIGRhdGUgdG8gYmUgcm91bmRlZFxuICAgIGNvbnN0IGludGVydmFsID0gMzAgKiA2MCAqIDEwMDA7IC8vIDMwIG1pbnV0ZXMgKGFrYSBxdWFydGVyIGhvdXIpXG4gICAgY29uc3QgZGF0ZU91dCA9IHJvdW5kKGRhdGVJbiwgaW50ZXJ2YWwpO1xuICAgIGNvbnN0IGZyb21UaW1lID0gZm9ybWF0KGRhdGVPdXQsICdISDptbScpO1xuICAgIHRoaXMuYWRkRXZlbnRzID0gbmV3IEZvcm1Hcm91cCh7XG4gICAgICB0aXRsZTogbmV3IEZvcm1Db250cm9sKCcnLCBWYWxpZGF0b3JzLnJlcXVpcmVkKSxcbiAgICAgIGxvY2F0aW9uOiBuZXcgRm9ybUNvbnRyb2woKSxcbiAgICAgIGRlc2NyaXB0aW9uOiBuZXcgRm9ybUNvbnRyb2woKSxcbiAgICAgIGZyb21EYXRlOiBuZXcgRm9ybUNvbnRyb2wobmV3IERhdGUoKSwgVmFsaWRhdG9ycy5yZXF1aXJlZCksXG4gICAgICB0b0RhdGU6IG5ldyBGb3JtQ29udHJvbCgnJywgVmFsaWRhdG9ycy5yZXF1aXJlZCksXG4gICAgICBmcm9tVGltZTogbmV3IEZvcm1Db250cm9sKGZyb21UaW1lLCBWYWxpZGF0b3JzLnJlcXVpcmVkKSxcbiAgICAgIHRvVGltZTogbmV3IEZvcm1Db250cm9sKCcnLCBWYWxpZGF0b3JzLnJlcXVpcmVkKSxcbiAgICB9KTtcblxuICAgIGlmKHRoaXMuZGF0YSl7XG4gICAgICB0aGlzLmFkZEV2ZW50cy5kaXNhYmxlKCk7XG4gICAgICB0aGlzLmFzc2lnbkV2ZW50RGV0YWlscygpO1xuICAgIH1cbiAgfVxuXG4gIGFkZE1pbnV0ZXNUb0RhdGUoZGF0ZSwgbWludXRlcykge1xuICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpICsgbWludXRlcyo2MDAwMCk7XG4gIH1cblxuICBhc3NpZ25FdmVudERldGFpbHMoKXtcbiAgICB0aGlzLnNjcmVlblR5cGUgPSBcImVkaXRcIjtcbiAgICB0aGlzLmFkZEV2ZW50cy5jb250cm9sc1sndGl0bGUnXS5zZXRWYWx1ZSh0aGlzLmRhdGEudGl0bGUpO1xuICAgIHRoaXMuYWRkRXZlbnRzLmNvbnRyb2xzWydsb2NhdGlvbiddLnNldFZhbHVlKHRoaXMuZGF0YS5sb2NhdGlvbik7XG4gICAgdGhpcy5hZGRFdmVudHMuY29udHJvbHNbJ2Rlc2NyaXB0aW9uJ10uc2V0VmFsdWUodGhpcy5kYXRhLmRlc2NyaXB0aW9uKTtcbiAgICB0aGlzLmFkZEV2ZW50cy5jb250cm9sc1snZnJvbURhdGUnXS5zZXRWYWx1ZSh0aGlzLmRhdGEuc3RhcnQpO1xuICAgIHRoaXMuYWRkRXZlbnRzLmNvbnRyb2xzWyd0b0RhdGUnXS5zZXRWYWx1ZSh0aGlzLmRhdGEuZW5kKTtcbiAgICB0aGlzLmFkZEV2ZW50cy5jb250cm9sc1snZnJvbVRpbWUnXS5zZXRWYWx1ZSh0aGlzLmRhdGEuZnJvbVRpbWUpO1xuICAgIHRoaXMuYWRkRXZlbnRzLmNvbnRyb2xzWyd0b1RpbWUnXS5zZXRWYWx1ZSh0aGlzLmRhdGEudG9UaW1lKTtcbiAgfVxuXG4gIGFkZE9yVXBkYXRlRXZlbnQoKSB7XG4gICAgbGV0IHRlbXBPYmplY3QgPSB7XG4gICAgICB0aXRsZTogdGhpcy5hZGRFdmVudHMuY29udHJvbHNbJ3RpdGxlJ10udmFsdWUsXG4gICAgICBkZXNjcmlwdGlvbjogdGhpcy5hZGRFdmVudHMuY29udHJvbHNbJ2Rlc2NyaXB0aW9uJ10udmFsdWUsXG4gICAgICBsb2NhdGlvbjogdGhpcy5hZGRFdmVudHMuY29udHJvbHNbJ2xvY2F0aW9uJ10udmFsdWUsXG4gICAgICBzdGFydDogdGhpcy5hZGRFdmVudHMuY29udHJvbHNbJ2Zyb21EYXRlJ10udmFsdWUsXG4gICAgICBlbmQ6IHRoaXMuYWRkRXZlbnRzLmNvbnRyb2xzWyd0b0RhdGUnXS52YWx1ZSxcbiAgICAgIGZyb21UaW1lOiB0aGlzLmFkZEV2ZW50cy5jb250cm9sc1snZnJvbVRpbWUnXS52YWx1ZSxcbiAgICAgIHRvVGltZTogdGhpcy5hZGRFdmVudHMuY29udHJvbHNbJ3RvVGltZSddLnZhbHVlXG4gICAgfTtcbiAgICBsZXQgc3RhcnREYXRldGltZSA9IHRlbXBPYmplY3Quc3RhcnQrJyAnK3RlbXBPYmplY3QuZnJvbVRpbWVcbiAgICBsZXQgZW5kRGF0ZXRpbWUgPSB0ZW1wT2JqZWN0LmVuZCsnICcrdGVtcE9iamVjdC50b1RpbWVcbiAgICBjb25zb2xlLmxvZyhcInN0YXJ0RGF0ZXRpbWUsIGVuZERhdGV0aW1lXCIsIHN0YXJ0RGF0ZXRpbWUsIGVuZERhdGV0aW1lKVxuICAgIGlmKHRoaXMuZGF0YSA9PT0gbnVsbCl7XG4gICAgICB0aGlzLmV2ZW50RW1pdHRlclNlcnZpY2UuZW1pdE5hdkNoYW5nZUV2ZW50KCdBRERfU0FWRV9DTElDS0VEJywgdGVtcE9iamVjdCk7XG4gICAgfWVsc2Uge1xuICAgICAgdGhpcy5ldmVudEVtaXR0ZXJTZXJ2aWNlLmVtaXROYXZDaGFuZ2VFdmVudCgnRURJVF9TQVZFX0NMSUNLRUQnLCB0ZW1wT2JqZWN0KTtcbiAgICB9XG4gICAgdGhpcy5kaWFsb2dSZWYuY2xvc2UoKTtcbiAgfVxuXG4gIG9uTm9DbGljaygpOiB2b2lkIHtcbiAgICB0aGlzLmRpYWxvZ1JlZi5jbG9zZSgpO1xuICB9XG5cbiAgb25EZWxldGUoKSB7XG4gICAgdGhpcy5ldmVudEVtaXR0ZXJTZXJ2aWNlLmVtaXROYXZDaGFuZ2VFdmVudCgnREVMRVRFX0VWRU5UX0NMSUNLRUQnLCB0aGlzLmRhdGEpO1xuICAgIHRoaXMuZGlhbG9nUmVmLmNsb3NlKCk7XG4gIH1cblxuICBvbkVkaXQoKSB7XG4gICAgdGhpcy5hZGRFdmVudHMuZW5hYmxlKClcbiAgfVxuXG5cbn1cbiJdfQ==